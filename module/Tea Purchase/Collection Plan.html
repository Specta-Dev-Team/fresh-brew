<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collection Plan | Custom Interface</title>

    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Fresh Brew Design System -->
    <link rel="stylesheet" href="../../template/css/design-system.css">
    <link rel="stylesheet" href="../../template/css/components.css">

    <style>
        /* --- CUSTOM STYLES FOR COLLECTION PLAN --- */

        /* Custom wider card for Collection Plan */
        .fb-glass-card {
            max-width: 1300px;
        }

        /* Override stepper layout for this page */
        .fb-stepper {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 4rem !important;
            margin: 1.5rem 0 !important;
        }

        .fb-step {
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
            cursor: pointer !important;
            opacity: 0.5 !important;
            transition: all 0.3s !important;
        }

        .fb-step.active {
            opacity: 1 !important;
        }

        .fb-step-icon {
            width: 36px !important;
            height: 36px !important;
            border-radius: 50% !important;
            background: #EEF2FF !important;
            border: 2px solid #E0E7FF !important;
            color: var(--primary) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-weight: 600 !important;
            transition: all 0.3s !important;
        }

        .fb-step.active .fb-step-icon {
            background: var(--primary) !important;
            color: white !important;
            border-color: var(--primary) !important;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3) !important;
        }

        .fb-step.completed .fb-step-icon {
            background: #C7D2FE !important;
            color: var(--primary) !important;
            border-color: #A5B4FC !important;
        }

        .fb-step-label {
            font-family: var(--font-main) !important;
            font-weight: 600 !important;
            font-size: 0.9rem !important;
            color: var(--secondary) !important;
            transition: all 0.3s !important;
        }

        .fb-step.active .fb-step-label {
            color: var(--text-main) !important;
        }

        /* Custom grid for Collection Plan */
        .fb-grid-4 {
            gap: 1.5rem;
        }

        /* Custom table min-width for Collection Plan */
        .fb-table {
            min-width: 1400px;
        }

        /* Custom footer for stepper */
        .fb-footer {
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #F1F5F9;
        }

        /* Button overrides for Collection Plan */
        .fb-footer .fb-btn {
            min-width: 180px;
            padding: 0.75rem 2rem;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .fb-footer .fb-btn-secondary {
            background: white;
            border: 1px solid #E2E8F0;
            color: var(--text-main);
        }

        .fb-footer .fb-btn-secondary:hover {
            background: #F8FAFC;
            border-color: #CBD5E1;
        }

        .fb-footer .fb-btn-primary {
            background: var(--primary);
            border: 1px solid var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.2);
        }

        .fb-footer .fb-btn-primary:hover {
            background: var(--primary-hover);
            border-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(79, 70, 229, 0.3);
        }

        .input-error {
            border-left: 3px solid #EF4444 !important;
        }

        /* Custom toggle group for this form */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.3rem;
        }

        /* Conditional column visibility */
        .location-column {
            display: none;
        }

        /* Step number styling */
        .step-number {
            font-size: 1rem;
            font-weight: 600;
        }
    </style>
</head>

<body>

    <div class="fb-wrapper">
        <div class="fb-glass-card">

            <!-- HEADER TITLE -->
            <div class="fb-header">
                <div class="fb-page-title" style="display: flex; align-items: center; gap: 1rem;">
                    <button class="fb-btn fb-btn-white" style="background:transparent; padding:0; min-width: unset; border: none;">
                        <span class="material-icons" style="font-size: 1.5rem; color: var(--secondary);">arrow_back</span>
                    </button>
                    <h1>Collection Plan</h1>
                </div>
                <div class="fb-header-actions" style="display: flex; align-items: center; gap: 1rem;">
                    <button class="fb-btn fb-btn-white">
                        <span class="material-icons">search</span>
                    </button>
                    <button class="fb-btn fb-btn-white">
                        <span class="material-icons">menu</span>
                    </button>
                    <button class="fb-btn fb-btn-white">
                        <span class="material-icons">grid_view</span>
                    </button>
                </div>
            </div>

            <!-- STEPPER -->
            <div class="fb-stepper">
                <div class="fb-step active" onclick="activateStep(1)">
                    <div class="fb-step-icon">
                        <span class="step-number">1</span>
                    </div>
                    <div class="fb-step-label">Header</div>
                </div>
                <div class="fb-step" onclick="activateStep(2)">
                    <div class="fb-step-icon">
                        <span class="step-number">2</span>
                    </div>
                    <div class="fb-step-label">Item Particulars</div>
                </div>
                <div class="fb-step" onclick="activateStep(3)">
                    <div class="fb-step-icon">
                        <span class="step-number">3</span>
                    </div>
                    <div class="fb-step-label">Summary</div>
                </div>
            </div>

            <!-- FORM CONTENT - STEP 1 -->
            <div id="step-1-content" class="fb-form-section">
                <!-- Row 1 -->
                <div class="fb-grid-4">
                    <div class="fb-form-group">
                        <label>CP No.</label>
                        <input type="text" value="Auto" readonly style="background-color: #F8F9FA;">
                    </div>
                    <div class="fb-form-group">
                        <label class="required">CP Date</label>
                        <input type="date" id="cp_date">
                    </div>
                    <div class="fb-form-group">
                        <label class="required">Company</label>
                        <select>
                            <option value="">Select an option</option>
                            <option value="Vintage Teas Ceylon (Pvt) Ltd" selected>Vintage Teas Ceylon (Pvt) Ltd</option>
                        </select>
                    </div>
                    <div class="fb-form-group">
                        <label>Route Name</label>
                        <input type="text" placeholder="Enter route name...">
                    </div>
                </div>

                <!-- Row 2 -->
                <div class="fb-grid-4">
                    <div class="fb-form-group">
                        <label class="required">Lorry Number</label>
                        <select id="lorry_number">
                            <option value="">Select an option</option>
                            <option value="LO-0954" selected>LO-0954</option>
                        </select>
                    </div>
                    <div class="fb-form-group">
                        <label>Lorry Name</label>
                        <input type="text" placeholder="LO-0954" readonly style="background-color: #F8F9FA;">
                    </div>
                    <div class="fb-form-group">
                        <label>Driver Name</label>
                        <input type="text" placeholder="WEERASINGHA">
                    </div>
                    <div class="fb-form-group">
                        <label>Cleaner Name</label>
                        <input type="text" placeholder="Enter cleaner name...">
                    </div>
                </div>

                <!-- Row 3 - All remaining fields together -->
                <div class="fb-grid-4">
                    <div class="fb-form-group">
                        <label>Worker Details</label>
                        <input type="text" placeholder="Enter worker details...">
                    </div>
                    <div class="fb-form-group">
                        <label>Capacity [in Kgs]</label>
                        <input type="number" placeholder="22,000.00">
                    </div>
                    <div class="fb-form-group">
                        <label>Is Supplier Delivery</label>
                        <div class="toggle-group">
                            <label class="fb-toggle-switch">
                                <input type="checkbox" id="is_supplier_delivery">
                                <span class="fb-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="fb-form-group">
                        <label>AMSB</label>
                        <div class="toggle-group">
                            <label class="fb-toggle-switch">
                                <input type="checkbox" id="amsb">
                                <span class="fb-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FORM CONTENT - STEP 2 -->
            <div id="step-2-content" class="fb-form-section" style="display: none;">
                <div class="fb-table-container">
                    <table class="fb-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px; text-align:center;">S.No</th>
                                    <th style="width: 165px;">PO No.</th>
                                    <th style="width: 86px;">Item Code</th>
                                    <th style="width: 279px;">Supplier</th>
                                    <th style="width: 108px;">Serial No/Box No</th>
                                    <th style="width: 68px;">Supp. Lot No</th>
                                    <th style="width: 67px;">Sale Code</th>
                                    <th style="width: 145px;">Garden Mark</th>
                                    <th style="width: 65px;">Grade</th>
                                    <th style="width: 76px;">Supp. Inv No</th>
                                    <th style="width: 97px;" class="dono-column">DO No.</th>
                                    <th style="width: 139px;" class="delivery-column">Collection of Goods</th>
                                    <th style="width: 105px; display: none;">Garden Code</th>
                                    <th style="width: 121px; display: none;">Purchase Type</th>
                                    <th style="width: 60px;">Standard</th>
                                    <th style="width: 96px; text-align: right;">Qty (Kgs)</th>
                                    <th style="width: 62px; text-align: right;">Bags</th>
                                    <th style="width: 63px; text-align: right;">Bag Weight (Kgs)</th>
                                    <th style="width: 76px; text-align: right; display: none;">Sample (Kgs)</th>
                                    <th style="width: 87px; text-align: right;">Total Weight (Kgs)</th>
                                    <th style="width: 111px; text-align: right; display: none;">Rain Forest</th>
                                    <th style="width: 300px;">Location</th>
                                    <th style="width: 165px;">Unloading Advice</th>
                                    <th style="width: 100px; text-align: center;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="items_grid_body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                <div style="background: #F8FAFC; padding: 0.5rem 1rem; border-top: 1px solid #E2E8F0;">
                    <button class="fb-btn fb-btn-white fb-btn-sm" onclick="addItemRow()">
                        <span class="material-icons" style="font-size: 16px;">add</span> New
                    </button>
                </div>
            </div>

            <!-- FORM CONTENT - STEP 3 -->
            <div id="step-3-content" class="fb-form-section" style="display: none;">
                <!-- Totals Row -->
                <div class="fb-grid-2">
                    <div class="fb-form-group">
                        <label style="font-weight: bold; color: #333;">Total Quantity (Kgs)</label>
                        <input type="text" placeholder="0.00" class="text-right"
                            style="color: #EF4444; font-weight: 600; background-color: #F8F9FA; border: 1px solid #E2E8F0;">
                    </div>
                    <div class="fb-form-group">
                        <label style="font-weight: bold; color: #333;">Total Bags</label>
                        <input type="text" placeholder="0" class="text-right"
                            style="color: #EF4444; font-weight: 600; background-color: #F8F9FA; border: 1px solid #E2E8F0;">
                    </div>
                </div>

                <!-- Remarks Row -->
                <div class="fb-form-group">
                    <label style="font-weight: bold; color: #333;">Remarks</label>
                    <textarea rows="5" placeholder="" style="resize: vertical;"></textarea>
                </div>
            </div>

            <!-- FOOTER -->
            <div class="fb-footer">
                <button class="fb-btn fb-btn-secondary" onclick="previousStep()">
                    Back
                </button>
                <button class="fb-btn fb-btn-primary" id="fb-footer-btn" onclick="nextStep()">
                    Continue
                </button>
            </div>

        </div>
    </div>

    <script>
        let currentStep = 1;

        function activateStep(stepIndex) {
            currentStep = stepIndex;
            updateUI();
        }

        function nextStep() {
            if (currentStep < 3) {
                currentStep++;
                updateUI();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateUI();
            }
        }

        function updateUI() {
            // Update Stepper
            document.querySelectorAll('.fb-step').forEach((step, index) => {
                const stepNumber = index + 1;
                const isActive = stepNumber === currentStep;
                const isCompleted = stepNumber < currentStep;
                
                // Remove all state classes
                step.classList.remove('active', 'completed');
                
                // Add appropriate class
                if (isActive) {
                    step.classList.add('active');
                } else if (isCompleted) {
                    step.classList.add('completed');
                }
                
                // Update icon content
                const icon = step.querySelector('.fb-step-icon');
                if (isCompleted) {
                    icon.innerHTML = '<span class="material-icons" style="font-size: 1.2rem;">check</span>';
                } else {
                    icon.innerHTML = `<span class="step-number">${stepNumber}</span>`;
                }
            });

            // Update Content Visibility
            document.getElementById('step-1-content').style.display = currentStep === 1 ? 'flex' : 'none';
            document.getElementById('step-2-content').style.display = currentStep === 2 ? 'flex' : 'none';
            document.getElementById('step-3-content').style.display = currentStep === 3 ? 'flex' : 'none';

            // Update Footer Button Text
            const btn = document.getElementById('fb-footer-btn');
            btn.innerText = currentStep === 3 ? 'Submit' : 'Continue';
        }

        // Initialize dates and grid
        window.addItemRow = function () {
            const tbody = document.getElementById('items_grid_body');
            const rowCount = tbody.querySelectorAll('tr').length + 1;
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="text-align:center; color:var(--secondary);">${rowCount}</td>
                <td><input type="text" placeholder="PO No."></td>
                <td><input type="text" placeholder="Item Code"></td>
                <td><input type="text" placeholder="Supplier"></td>
                <td><input type="text" placeholder="Serial/Box"></td>
                <td><input type="text" placeholder="Lot No"></td>
                <td><input type="text" placeholder="Sale Code"></td>
                <td><input type="text" placeholder="Garden Mark"></td>
                <td>
                    <select style="width: 100%;">
                        <option value="">Select a...</option>
                        <option value="Grade A">Grade A</option>
                        <option value="Grade B">Grade B</option>
                    </select>
                </td>
                <td><input type="text" placeholder="Inv No"></td>
                <td class="dono-column"><input type="text" placeholder="DO No." class="dono-input"></td>
                <td class="delivery-column"><select class="delivery-select" style="width: 100%;">
                    <option value="">Select...</option>
                    <option value="Own">Own</option>
                    <option value="Supplier">Supplier</option>
                </select></td>
                <td style="display:none;"><input type="text" placeholder="Garden Code"></td>
                <td style="display:none;"><input type="text" placeholder="Purchase Type"></td>
                <td><input type="text" placeholder="Standard"></td>
                <td><input type="number" class="text-right" placeholder="0.00"></td>
                <td><input type="number" class="text-right" placeholder="0"></td>
                <td><input type="number" class="text-right" placeholder="0.00"></td>
                <td style="display:none;"><input type="number" class="text-right" placeholder="0.00"></td>
                <td><input type="number" class="text-right" placeholder="0.00"></td>
                <td style="display:none;"><input type="text" placeholder="Rain Forest"></td>
                <td class="location-column"><input type="text" placeholder="Location"></td>
                <td><input type="text" placeholder="Unloading Advice"></td>
                <td style="text-align: center;">
                    <button class="fb-btn fb-btn-white" style="padding: 0.2rem 1rem; font-size: 0.75rem; min-width: 60px; border-radius: 4px;">OK</button>
                    <button style="background:none; border:none; color:#EF4444; cursor:pointer;" onclick="this.closest('tr').remove()">
                        <span class="material-icons" style="font-size:18px;">delete</span>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
            
            // Attach event listener to Collection of Goods dropdown
            const deliverySelect = tr.querySelector('.delivery-select');
            deliverySelect.addEventListener('change', function() {
                updateLocationVisibility();
            });
            
            // Initialize location visibility
            updateLocationVisibility();
        }

        // Function to update Location column visibility based on delivery data
        function updateLocationVisibility() {
            const tbody = document.getElementById('items_grid_body');
            const rows = tbody.querySelectorAll('tr');
            
            // Check if any row has delivery data filled
            let hasDeliveryData = false;
            rows.forEach(row => {
                const deliverySelect = row.querySelector('.delivery-select');
                if (deliverySelect && deliverySelect.value) {
                    hasDeliveryData = true;
                }
            });
            
            // Show/hide location column and header
            const locationCells = document.querySelectorAll('.location-column');
            const locationHeader = document.querySelector('th:has(+ th.location-column), th.location-header');
            
            locationCells.forEach(cell => {
                cell.style.display = hasDeliveryData ? 'table-cell' : 'none';
            });
            
            // Also handle header if it exists
            const headers = document.querySelectorAll('th');
            headers.forEach((header, index) => {
                if (header.textContent.includes('Location')) {
                    header.style.display = hasDeliveryData ? 'table-cell' : 'none';
                }
            });
        }

        // Initialize dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('cp_date').value = today;

        // Add default row
        addItemRow();
        
        // Initialize location visibility
        updateLocationVisibility();
    </script>
</body>

</html>
